@**
 * Copyright (C) 2013 Kaj Magnus Lindberg (born 1979)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *@

@(tpi: debiki.SiteTpi, searchResult: com.debiki.v0.FullTextSearchResult)

@import com.debiki.v0._

@foundWhere(hit: FullTextSearchHit) = @{
  hit.post.id match {
    case PageParts.TitleId => "In the title"
    case PageParts.BodyId => "In the page text"
    case PageParts.ConfigPostId => "In the configuration"
    case _ => "In a comment"
  }
}



@* Add later:   , by { hit.post.user_!.displayName }:</em>   *@

@searchResultsHtml = @{
  <div>{
    for (hit <- searchResult.hits) yield {
      val pageId = hit.post.page.id
      val anyPageMeta = searchResult.pageMetaByPageId.get(pageId)
      val pageTitle = anyPageMeta.flatMap(_.cachedTitle) getOrElse "(Unnamed page)"
      <h3 class="search-result-page-title">
        <a href={s"/-$pageId"}>{pageTitle}</a>
      </h3>
      <em>{ foundWhere(hit) }:</em>
      <p class="search-result-post-text">
        <a href={s"/-${hit.post.page.id}#post-${hit.post.id}"}>{
          hit.highlights mkString " ... "
        }</a>
      </p>
    }
  }</div>
}

@wrapper(tpi) {
  <!-- default20121009/searchResults.scala.html -->

  <h1>Search Results</h1>

  @searchResultsHtml
}

